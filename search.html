<html>
  <head>
    <link rel="stylesheet" type="text/css" href="/main.css">
    <link rel="stylesheet" type="text/css" href="main.css">
    <link href='http://fonts.googleapis.com/css?family=Cherry+Swash' rel='stylesheet' type='text/css'>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://qrohlf.com/trianglify/trianglify.js"></script>
    <link rel="stylesheet" href="buttons.css">
    <title>seekbar</title>
  </head>
  <body>
    <script>
    var t = new Trianglify();
    var pattern = t.generate(document.body.clientWidth, document.body.clientHeight);
    document.body.setAttribute('style', 'background: ' + pattern.dataUrl + 'no-repeat center center fixed');
    </script>
    <div id="boxen">
      <div class='box map'><div id='map-canvas' style="width: 100%; height: 35%;"></div></div>
      <div class="box">
        <h1 id="loading">Loading...</h1>
        <ul id="products">

        </ul>
      </div>
    </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBd809o1TY1rGV_1vhZA22AiFJnOJhZJHk"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
    var socket = io();

    var q = getUrlVars()["q"];
    var zip = getUrlVars()["zip"];

    socket.emit("search", q, zip);

    socket.on('results', function(products) {
      for (var i = 0; i < products.length; i++) {
        $('#products').append("<li class='product'><div onclick='emit_product(\"" + products[i].name + "\");'><img src='" + products[i].image + "'><p>" + products[i].name + "</p></div></li>");
        $("#loading").css("display", "none");
      }
    });

    socket.on('stores', function(stores) {
      function initialize() {
        var mapOptions = {
          center: { lat: stores[0].lat, lng: stores[0].lng },
          zoom: 16
        };
        var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

        for (var i = 0; i < stores.length; i++) {
          console.log('lat: ' + stores[i].lat + ', lng: ' + stores[i].lng);
          var marker = new google.maps.Marker({
            position: { lat: stores[i].lat, lng: stores[i].lng },
            map: map,
            title: String(stores[i].name)
          });
        }
      }
      initialize();
    });

    function emit_product(name) {
      socket.emit('product', name);
      $("html, body").animate({ scrollTop: 0 }, "slow");
      $(".map").css("display", "block");
    }

    function getUrlVars() {
      var vars = {};
      var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,
      function(m,key,value) {
        vars[key] = value;
      });
      return vars;
    }
    </script>
  </body>
</html>
